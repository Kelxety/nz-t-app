<nz-layout>
  <nz-sider nzCollapsible [(nzCollapsed)]="isCollapsed" [nzTrigger]="null" nzWidth="450px" nzTheme="light"
    nzBreakpoint="sm" [nzCollapsedWidth]="50">

    <nz-header>
      <span class="trigger float-right items-center p-4 text-xl" nz-icon
        [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'" (click)="isCollapsed = !isCollapsed"></span>
    </nz-header>

    <form nz-form [formGroup]="validateForm" id="validateForm">
      <nz-card [hidden]="isCollapsed">

        <nz-form-item>
          <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="itemCode" nzLabelWrap>Item
            Code</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24">
            <input nz-input type="text" formControlName="itemCode" placeholder="Item Code" id="itemCode" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label [nzSpan]="6" nzLabelAlign="left" nzRequired>Item Name</nz-form-label>
          <nz-form-control [nzSpan]="14" nzHasFeedback nzErrorTip="Please input your Item name!">
            <input nz-input formControlName="itemName" placeholder="Item Name" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzRequired nzFor="itemcategoryId" nzLabelWrap>Item
            Category</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24" nzHasFeedback nzErrorTip="Please input your Item Category!">
            <nz-tree-select [nzNodes]="treeData" formControlName="itemcategoryId" id="itemcategoryId" nzShowSearch
              nzPlaceHolder="Please select" nzVirtualHeight="300px" nzHideUnMatched="true"></nz-tree-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="itemDescription">Description</nz-form-label>
          <nz-form-control [nzSm]="14" [nzXs]="24">
            <textarea rows="4" placeholder="Description" nz-input formControlName="itemDescription"
              id="itemDescription"></textarea>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="state">Status</nz-form-label>
          <nz-select [nzOptions]="listOfOption" formControlName="state" id="state"></nz-select>
        </nz-form-item>
        <div class="float-right px-4">
          <button nz-button nzType="primary" [disabled]="this.btnDisable" type="submit" (click)="onCreateItem()">
            <span nz-icon nzType="save" nzTheme="outline"></span>
            Save
          </button>
        </div>
      </nz-card>
    </form>
  </nz-sider>

  <nz-layout>
    <div class="m-2 h-auto">
      <nz-card nzTitle="Add Items" class="w-full" [nzExtra]="options" [nzHoverable]="true">
        <form nz-form [formGroup]="validateFormDetail" id="validateFormDetail">
          <div class="flex flex-row gap-2">
            <div class="w-[45%]">
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="entryDate" nzLabelWrap>Entry
                  Date</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                  <nz-date-picker formControlName="entryDate"></nz-date-picker>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="expirationDate" nzLabelWrap>Expiration
                  Date</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                  <nz-date-picker formControlName="expirationDate"></nz-date-picker>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzSm]="6" nzHasFeedback [nzXs]="24" nzFor="subitemCode"
                  nzLabelWrap>SubItem
                  Code</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                  <input nz-input placeholder="Sub Item code" formControlName="subitemCode" id="subitemCode" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzErrorTip="Please input your SubItem Name!" nzLabelAlign="left" [nzSm]="6" nzRequired
                  [nzXs]="24" nzFor="subitemName" nzLabelWrap>SubItem
                  Name</nz-form-label>
                <nz-form-control [nzSm]="14" nzHasFeedback [nzXs]="24">
                  <input nz-input placeholder="Sub Item name" formControlName="subitemName" id="subitemName" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="barcode">Barcode</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                  <input nz-input formControlName="barcode" id="barcode" placeholder="Barcode" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzErrorTip="Please input your Unit!" nzLabelAlign="left" nzHasFeedback [nzSm]="6"
                  nzRequired [nzXs]="24" nzFor="unitId">Unit</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" nzHasFeedback>
                  <nz-select nzShowSearch nzAllowClear nzStatus="error" nzAllowClear nzPlaceHolder="Select a unit"
                    formControlName="unitId" id="unitId">
                    <nz-option *ngFor="let o of optionList" [nzValue]="o.id" [nzLabel]="o.unitAcro"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzSm]="6" [nzXs]="24" nzFor="brandName" nzLabelWrap>Brand
                  Name</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                  <input nz-input formControlName="brandName" id="brandName" placeholder="Brand name" />
                </nz-form-control>
              </nz-form-item>
              <div class="grid grid-cols-2 -gap-y-6 gap-x-2">
                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" [nzXs]="24" nzFor="lotNo" nzLabelWrap>Lot
                    no.</nz-form-label>
                  <nz-form-control [nzXs]="24">
                    <input nz-input formControlName="lotNo" id="lotNo" placeholder="Lot. no" />
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" [nzXs]="24" nzFor="batchNo" nzLabelWrap>Batch
                    no.</nz-form-label>
                  <nz-form-control [nzXs]="24">
                    <input nz-input formControlName="batchNo" id="batchNo" placeholder="Batch no." />
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" nzErrorTip="Please input Cost!" nzRequired [nzXs]="24" nzFor="cost"
                    onchange="onComputeCost">Cost</nz-form-label>
                  <nz-form-control [nzXs]="24" nzHasFeedback>
                    <nz-space nzDirection="vertical" class="w-full">
                      <nz-input-number-group *nzSpaceItem nzPrefix="₱" class="w-full">
                        <nz-input-number formControlName="cost" id="cost" [nzStep]="1"></nz-input-number>
                      </nz-input-number-group>
                    </nz-space>
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" [nzXs]="24" nzFor="balanceQty" nzHasFeedback
                    nzErrorTip="Please input Quantity!">Quantity</nz-form-label>
                  <nz-form-control [nzXs]="24" nzHasFeedback>
                    <input nz-input formControlName="balanceQty" type="number" id="balanceQty" />
                  </nz-form-control>
                </nz-form-item>

                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" [nzXs]="24" nzFor="markup"
                    onchange="onComputeMarkup">Markup</nz-form-label>
                  <nz-form-control [nzXs]="24">
                    <input nz-input formControlName="markup" type="number" id="markup" />
                  </nz-form-control>
                </nz-form-item>
                <nz-form-item>
                  <nz-form-label nzLabelAlign="left" nzRequired [nzXs]="24" nzFor="price"
                    nzErrorTip="Please input Price!">Price</nz-form-label>
                  <nz-form-control [nzXs]="24" nzHasFeedback>
                    <nz-space nzDirection="vertical" class="w-full">
                      <nz-input-number-group *nzSpaceItem nzPrefix="₱" class="w-full">
                        <nz-input-number formControlName="price" id="price" [nzStep]="1"></nz-input-number>
                      </nz-input-number-group>
                    </nz-space>
                  </nz-form-control>
                </nz-form-item>
              </div>
              <nz-form-item>
                <nz-form-label nzLabelAlign="left" [nzXs]="24" nzFor="state">Status</nz-form-label>
                <nz-form-control [nzXs]="24">
                  <nz-select [nzOptions]="listOfOption" formControlName="state" id="state"></nz-select>
                </nz-form-control>
              </nz-form-item>
              <div class=" float-right px-4">
                <nz-form-control>
                  <button [disabled]="this.dtlBtn" nz-button nzType="primary" type="submit" (click)="onAddItem()">
                    <span nz-icon nzType="save" nzTheme="outline"></span>
                    Add
                  </button>
                </nz-form-control>
              </div>
            </div>
            <nz-card class=" my-4" nzTitle="Item List" class="w-[100%]">
              <div class="loc-content" *ngIf="!model.loading; else isLoading">
                <nz-table nzShowSizeChanger #fixedTable [nzData]="model.filteredList" [nzSize]="'default'"
                  [nzScroll]="{ x: '100%', y: 'calc(100vh - 330px)' }"
                  (nzCurrentPageDataChange)="onCurrentPageDataChange($event)" [nzPageSize]="10">
                  <thead>
                    <tr>
                      <th nzWidth="120px">Entry & Exp. Date</th>
                      <th nzWidth="110px">Item code</th>
                      <th nzWidth="200px">Brand Name/Item Name</th>
                      <th nzWidth="90px" nzAlign="center">Quantity</th>
                      <th nzWidth="100px" nzAlign="right">Cost</th>
                      <th nzWidth="100px" nzAlign="right">Price</th>
                      <th nzWidth="90px">Status</th>
                      <th nzWidth="80px" class="text-right">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let data of fixedTable.data">
                      <td>
                        <div class="flex flex-col">
                          <span class="font-semibold">{{ data?.entryDate | date : 'shortDate'}}</span>
                          <span class="text-xs text-gray-500">Exp. {{ data?.expirationDate | date : 'shortDate'}}</span>
                        </div>
                      </td>
                      <td nzEllipsis>{{ data?.subitemCode }}</td>
                      <td nzBreakWord>{{data.brandName}} - {{ data?.subitemName }}</td>
                      <td class="text-center">{{ data?.balanceQty }}</td>
                      <td nzEllipsis class="text-right">{{ data?.cost | currency : 'PHP' }}</td>
                      <td nzEllipsis class="text-right">{{ data?.price | currency : 'PHP' }}</td>
                      <td nzEllipsis><nz-badge [nzColor]="data.state === 'Active' ? 'green' : 'red'"
                          [nzText]="data?.state"></nz-badge>
                      </td>
                      <td class="text-right" style="padding-top: 2px; padding-bottom: 2px">
                        <span class="pointer" nz-icon nzType="edit" nzTheme="outline"></span>
                        <nz-divider nzType="vertical"></nz-divider>
                        <span class="pointer" nz-icon nzType="delete" nzTheme="outline" style="color: red" nz-popconfirm
                          nzPopconfirmTitle="Are you sure you want to delete {{ data.className }}"></span>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
              </div>
            </nz-card>
          </div>
        </form>
      </nz-card>
    </div>




    <ng-template #options>
      <div nz-space nzAlign="start">
        <nz-button-group *nzSpaceItem>
          <button class="pointer" nz-button nzType="text" class="text-xl items-center" nzTooltipTitle="Clear All"
            (click)="onCancel()" nzTooltipPlacement="topLeft" nz-tooltip>
            <span nz-icon nzType="clear" nzTheme="outline"></span>
          </button>
          <button class="pointer" nz-button nzType="text" class="text-xl items-center" nzTooltipTitle="Close"
            (click)="onCancel()" nzTooltipPlacement="topLeft" nz-tooltip>
            <span nz-icon nzType="close-square" nzTheme="twotone"></span>
          </button>

        </nz-button-group>
      </div>
    </ng-template>

    <ng-template #isLoading>
      <div style="padding: 24px">
        <nz-skeleton [nzActive]="true"></nz-skeleton>
        <nz-skeleton [nzActive]="true"></nz-skeleton>
      </div>
    </ng-template>